<%-include('navbar.ejs')%>

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<div class="container my-4">
    <div class="row mb-3">
        <div>
            <input type="text" class="form-control search-box shadow-sm" id="fileSearch" placeholder="ðŸ” Search by Order ID..." onkeyup="searchTable()">
        </div>
    </div>
    <h2 class="mb-4 text-center fw-bold text-primary">All Orders</h2>

    <!-- âœ… Scroll Wrapper -->
    <div class="table-responsive shadow-lg rounded-3">
        <table class="table table-bordered table-hover align-middle text-center" id="filesTable">
            <thead class="table-dark">
                <tr>
                    <th>No.</th>
                    <th>Action</th>
                    <th>Order ID</th>
                    <th>User ID</th>
                    <th>File ID</th>
                    <th>Transaction ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Mobile No.</th>
                    <th>Address</th>
                    <th>Design Name</th>
                    <th>Unit Price (â‚¹)</th>
                    <th>Qty</th>
                    <th>Total Price (â‚¹)</th>
                    <th>Status</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                <% for (let i = 0; i < orderData.length; i++) { %>
                <tr>
                    <td><%= ((currentPage - 1) * 10) + i + 1 %></td>

                    <!-- Action -->
                    <td class="action-btns">
                        <a href="/admin/delete_order/<%= orderData[i].order_id %>" class="btn btn-sm btn-danger" title="Delete" onclick="return confirm('Delete Order?')">
                            <i class="bi bi-trash3"></i>
                        </a>
                    </td>

                    <!-- IDs -->
                    <td class="fw-bold text-dark">#OID0<%= orderData[i].order_id %></td>
                    <td class="text-muted">#UID0<%= orderData[i].user_id %></td>
                    <td class="text-muted">#F0<%= orderData[i].file_id %></td>
                    <td class="text-muted">#TID0<%= orderData[i].transaction_id %></td>

                    <!-- User Info -->
                    <td class="fw-bold"><%= orderData[i].first_name %> <%= orderData[i].last_name %></td>
                    <td class="text-primary"><%= orderData[i].user_email %></td>
                    <td class="fw-bold text-success"><%= orderData[i].user_mobile %></td>
                    <td class="text-danger"><%= orderData[i].district %>, <%= orderData[i].state %>, <%= orderData[i].country %></td>

                    <!-- Design -->
                    <td class="fw-bold text-info"><%= orderData[i].design_name %></td>
                    <td class="fw-bold text-primary">â‚¹<%= orderData[i].final_price %></td>
                    <td class="fw-bold"><%= orderData[i].qty %></td>
                    <td class="fw-bold text-success">â‚¹<%= orderData[i].total_price %></td>

                    <!-- Status -->
                    <td class="text-success">
                        <span class="badge"></span>
                            <%= orderData[i].order_status %>
                        </span>
                    </td>
                    <!-- Date -->
                    <td><span class="badge bg-secondary"><%= orderData[i].order_date %></span></td>
                </tr>
                <% } %>
            </tbody>
        </table>
    </div>

    <!-- âœ… Pagination -->
    <div class="d-flex justify-content-center mt-4">
        <nav>
            <ul class="pagination">
                <% if (currentPage > 1) { %>
                    <li class="page-item">
                        <a class="page-link" href="/admin/all_orders?page=<%= currentPage - 1 %>">Previous</a>
                    </li>
                <% } %>

                <% for (let p = 1; p <= totalPages; p++) { %>
                    <li class="page-item <%= (p === currentPage) ? 'active' : '' %>">
                        <a class="page-link" href="/admin/all_orders?page=<%= p %>"><%= p %></a>
                    </li>
                <% } %>

                <% if (currentPage < totalPages) { %>
                    <li class="page-item">
                        <a class="page-link" href="/admin/all_orders?page=<%= currentPage + 1 %>">Next</a>
                    </li>
                <% } %>
            </ul>
        </nav>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    // âœ… Search by Order ID
    function searchTable() {
        const input = document.getElementById("fileSearch");
        const filter = input.value.toLowerCase();
        const table = document.getElementById("filesTable");
        const tr = table.getElementsByTagName("tr");

        for (let i = 1; i < tr.length; i++) {
            let td = tr[i].getElementsByTagName("td")[2]; // Order ID column
            if (td) {
                const txtValue = td.textContent || td.innerText;
                tr[i].style.display = txtValue.toLowerCase().includes(filter) ? "" : "none";
            }
        }
    }
</script>

<%-include('footer.ejs')%>
