<%- include('navbar.ejs') %>

<div class="admin-container">
  <div class="print-btn-wrapper d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-dark">Users Contact Responses</h2>
    <button onclick="window.print()" class="btn btn-dark print-btn">
      <i class="bi bi-printer-fill"></i> Print
    </button>
  </div>

  <!-- Search Input -->
  <div class="mb-4" style="width: 40%; margin-left: 60%;">
    <input type="text" id="searchInput" onkeyup="filterCards()" class="form-control" placeholder="Search by name...">
  </div>

  <!-- Printable Section -->
  <div id="printable">
    <h2 class="fw-bold text-dark text-center d-none d-print-block mb-4">Users Contact Responses</h2>

    <div class="row g-4" id="cardContainer">
      <!-- Response Cards -->
      <% for(let users = 0; users < userData.length; users++) { %>
        <div class="col-md-6 col-lg-4 contact-card">
          <div class="card card-response h-100 shadow-sm">
            <div class="card-header d-flex justify-content-between bg-dark text-white">
              <span><i class="bi bi-person-circle me-2"></i> <%= userData[users].user_name %></span>
              <a href="/admin/delete_response/<%= userData[users].user_id %>" onclick="return confirm('Delete this response')">
                <i class="bi bi-trash-fill text-danger" title="Delete"></i>
              </a>
            </div>
            <div class="card-body">
              <p><strong>Email:</strong> <%= userData[users].user_email %></p>
              <p><strong>Subject:</strong> <%= userData[users].user_subject %></p>
              <p><strong>Message:</strong></p>
              <div class="message-box"><%= userData[users].user_message %></div>
              <p class="mt-3"><strong>Date:</strong> <%= userData[users].date %></p>
            </div>
          </div>
        </div>
      <% } %>
    </div>

    <!-- âœ… Pagination -->
    <nav class="mt-5">
      <ul class="pagination justify-content-center">

        <!-- Previous Button -->
        <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
          <a class="page-link" href="/admin/enquiry_list?page=<%= currentPage - 1 %>">Previous</a>
        </li>

        <% 
          let startPage = Math.max(1, currentPage - 1); 
          let endPage = Math.min(totalPages, startPage + 2); 
          if (endPage - startPage < 2) {
            startPage = Math.max(1, endPage - 2);
          }
        %>

        <% for(let i = startPage; i <= endPage; i++){ %>
          <li class="page-item <%= i === currentPage ? 'active' : '' %>">
            <a class="page-link" href="/admin/enquiry_list?page=<%= i %>"><%= i %></a>
          </li>
        <% } %>

        <!-- Next Button -->
        <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
          <a class="page-link" href="/admin/enquiry_list?page=<%= currentPage + 1 %>">Next</a>
        </li>
      </ul>
    </nav>
  </div>
</div>


<%- include('footer.ejs') %>

<!-- JavaScript for Filtering Cards by Name -->
<script>
  function filterCards() {
    const input = document.getElementById('searchInput');
    const filter = input.value.toLowerCase();
    const cards = document.querySelectorAll('#cardContainer .contact-card');

    cards.forEach(card => {
      const nameText = card.querySelector('.card-header span').textContent.toLowerCase();
      if (nameText.includes(filter)) {
        card.style.display = '';
      } else {
        card.style.display = 'none';
      }
    });
  }
</script>
