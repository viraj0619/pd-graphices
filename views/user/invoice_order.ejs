<%- include("navbar.ejs") %>

<div class="invoice-page">
  <div class="container my-5">
    <div class="invoice-wrapper">

      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center border-bottom pb-3 mb-4 invoice-header flex-wrap">
        <div>
          <img src="/admin/uploads/<%=companyData[0].admin_logo%>" height="50" class="mb-2">
          <h4><%=companyData[0].company_name%></h4>
          <p><%=companyData[0].admin_address%></p>
        </div>
        <div class="text-end">
          <p><strong>Invoice:</strong> #TID0<%= orderData[0].transaction_id %></p>
          <p><strong>Date:</strong> <%= orderData[0].order_date %></p>
          <p><strong>Payment:</strong> <span class="text-success fw-bold">Paid (Online)</span></p>
          <p><strong>Payment ID:</strong> <%= orderData[0].payment_id %></p>
        </div>
      </div>

      <!-- Billing -->
      <div class="row mb-4">
        <div class="col-md-6">
          <h5 class="fw-bold">Billed To,</h5>
          <p>
            <%= orderData[0].first_name %> 
            <%= orderData[0].last_name %> <br>
            <%= orderData[0].user_email %><br>
            <%= orderData[0].user_mobile %><br>
            <%= orderData[0].district %>, <%= orderData[0].state %>, <%= orderData[0].country %>.
          </p>
        </div>
        <div class="col-md-6 text-md-end">
          <h5 class="fw-bold">From</h5>
          <p>
            <%=companyData[0].company_name%><br>
          <%=companyData[0].admin_address%>
          </p>
        </div>
      </div>

      <!-- Items -->
      <div class="table-responsive">
        <table class="table border-bottom text-center invoice-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Designs Name</th>
              <th>Qty</th>
              <th>Discount (%)</th>
              <th>Unit Price</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <% 
       let subTotal = 0; 
       for(let i=0; i < orderData.length; i++){ 
      var calTotal = orderData[i].file_price * orderData[i].qty;
      subTotal += calTotal;
  %>
            <tr>
              <td><%=i+1%>.</td>
              <td><%= orderData[i].design_name %></td>
              <td><%= orderData[i].qty %></td>
              <td><%= orderData[i].file_dis%></td>
              <td>₹<%= orderData[i].file_price %></td>
              <td>₹<%= orderData[i].file_price * orderData[i].qty %></td>
            </tr>
            <%}%>
          </tbody>
          <tfoot class="invoice-summary">
            <tr>
              <td colspan="5" class="text-end fw-bold">Subtotal</td>
              <td>₹<%=subTotal%></td>
            </tr>
            <tr>
              <td colspan="5" class="text-end">Discount</td>
              <td>-₹<%=subTotal - orderData[0].payment_amount%></td>
            </tr>
            <tr>
              <td colspan="5" class="text-end">Tax</td>
              <td>₹0</td>
            </tr>
            <tr>
              <td colspan="5" class="text-end fw-bold">Grand Total</td>
              <td class="fw-bold text-success">₹<%= orderData[0].payment_amount %></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- Footer -->
      <div class="text-center mt-4 invoice-footer border-top pt-3">
        Thank you for shopping with us! <br>
        Support: <a href="mailto:<%=companyData[0].admin_email%>"><%=companyData[0].admin_email%></a>
      </div>

      <!-- Actions -->
      <div class="text-center mt-4 no-print">
        <a href="/user_orders" class="btn btn-secondary btn-custom me-2">
          <i class="bi bi-arrow-left"></i> Back
        </a>
        <button onclick="window.print()" class="btn btn-success btn-custom">
          <i class="bi bi-printer"></i> Print
        </button>
      </div>
    </div>
  </div>
</div>

<%- include("footer.ejs") %>
