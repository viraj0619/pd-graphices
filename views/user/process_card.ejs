<%-include('navbar.ejs')%>
<section class="process-card mt-5">
<div class="hero">
  <div class="container">
    <div class="breadcrumb">
      <a href="/">Home</a> /
      <a href="/banners">Banners</a> /
      <span><%= fileData.design_name %> - 0<%= fileData.file_id %></span>
    </div>

    <h1><%=fileData.design_name%></h1>
  </div>
</div>

<div class="container">
  <div class="product-view">
    <div class="img-gallery">
      <img src="/admin/uploads/<%=fileData.file_img%>" alt="Banner" class="main-img" id="mainImg">
    </div>

    <div class="details">
      <div class="title"><%=fileData.design_name%> -0<%=fileData.file_id%></div>
      <div class="price">₹<%=fileData.final_price%>.00</div>
      <p class="dt">* Digital HD quality – high resolution for printing.</p>

      <!-- ADD TO CART FORM -->
      <form action="/add_cart/<%=fileData.file_id%>" method="POST" enctype="multipart/form-data">
        <div class="qty-selector">
          <button type="button" onclick="updateQty(-1)">−</button>
          <input type="text" readonly value="1" min="1" id="qty" name="qty">
          <button type="button" onclick="updateQty(1)">+</button>
        </div>

        <div class="actions">
          <% if (checkCartExist.length > 0) { %>
            <a href="/user_cart"><button class="add-cart" type="button">Go to cart</button></a>
          <% } else { %>
            <button class="add-cart" type="submit" id="addCartBtn">Add to Cart</button>
          <% } %>

          <!-- SHOP NOW DIRECT CHECKOUT WITH QTY -->
           <%if(fileData.stock=='instock'){%>
          <button class="buy-now" type="submit" formaction="/checkout/<%=fileData.file_id%>">Purchase Now</button>
          <%}else{%>
            <a href="/" class="btn text-danger">Out of Stack</a>
            <%}%>
        </div>
      </form>
    </div>
  </div>

  <div class="desc">
    <h3>Product Description</h3>
    <p><%=fileData.file_des%></p>
  </div>
</div>

<!-- Image Modal -->
<div id="imgModal" class="img-modal">
  <span onclick="closeModal()">&times;</span>
  <img id="modalImg" src="" alt="Full View">
</div>
</section>

<script>
  function updateQty(delta) {
    const input = document.getElementById('qty');
    let val = parseInt(input.value) + delta;
    input.value = val < 1 ? 1 : val;
  }

  // Modal Logic
  const mainImg = document.getElementById('mainImg');
  const modal = document.getElementById('imgModal');
  const modalImg = document.getElementById('modalImg');

  mainImg.addEventListener('click', () => {
    modal.style.display = 'flex';
    modalImg.src = mainImg.src;
    modalImg.style.marginTop = '80px'; // margin-top when modal opens
  });

  function closeModal() {
    modal.style.display = 'none';
    modalImg.style.marginTop = '0';
  }

  window.onclick = function (event) {
    if (event.target === modal) {
      closeModal();
    }
  };

  function disableButton(btn) {
    btn.form.querySelectorAll("button[id='addCartBtn']").forEach(b => {
    b.disabled = true;
    b.innerText = "Processing...";
  });
  }
</script>

<%-include('footer.ejs')%>
